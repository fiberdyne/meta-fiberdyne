-------------------------------------------------------------------------------------------
Fiberdyne Yocto Layer Setup
-------------------------------------------------------------------------------------------

This tutorial will guide you in setting up the meta-fiberdyne Yocto layer for the Poky 
build environment under Automotive Grade Linux on the Renesas M2 Porter.
For all purposes, the Yocto root directory will be referred to as $WORK.

-------------
Setup
-------------
1. Clone the "agl" branch of the meta-fiberdyne repository into $WORK/meta:

   cd $WORK/meta
   git clone https://github.com/fiberdyne/yocto-meta-fiberdyne.git --branch agl

2. Locate your Yocto bblayers configuration file at $WORK/build/conf/bblayers.conf 
   and add the following lines:

       BBLAYERS_append = " ${METADIR}/../meta-fiberdyne"

   Locate your Yocto local configuration file at $WORK/build/conf/local.conf
   and add the following lines:
    
       IMAGE_INSTALL_append = " fd-dsp"

3. Build your AGL image.

4. Once your image is built, a modification will need to be made to the weston.ini file residing at:

   /etc/xdg/weston/weston.ini
   
   Add the following lines to the file:
  
   [launcher]
   icon=/usr/share/icons/hicolor/32x32/apps/rygel.png
   path=/usr/bin/_fd-dsp-ui
   
   And change the shell variable to:
   shell=desktop-shell.so

   Then run:
   systemctl restart weston

   You will now have an launcher icon in the top left corner, and this is used to launch the fd-dsp UI.

5. Reboot, and the fd-dsp daemon should be running. There should be audio coming from the LINE OUT auxillary.

6. Tap the icon to use the UI

[NOTE]
  It is possible to run the UI from the AGL HomeScreen, however there is currently a bug in it that prohibits
  aour package to be installed.  This will come in future updates.
  
[NOTE]
  This layer renders the AGL-netboot feature unusable, due to a conflict in reserved memory

   
-------------------------------------------------------------------------------------------
System Audio Info
-------------------------------------------------------------------------------------------
ALSA has been used to define three audio sinks that supports simultaneous playback 
within multiple processes. 
The underlying ALSA driver supports 48000 KHz sample rate only.

1. sinkStereo 
   Dual channel 32-bit input that emulates any stereo audio (i.e :- music)

2. sinkTel 
   Single channel 32-bit input for telephone audio
  
3. sinkPdc
   Single channel 32-bit input for navigation audio and other mono audio sources

The test application fd-dsp-test uses the standard ALSA tool, aplay, to play stereo
audio using sinkStereo. 
The other sinks can be tested via the same commands used in the test script. 

It must also be noted that, due to the AK4643 codec driver being implemented as a ALSA
device driver, ALSA must be used to initialize the codec for 16-bit audio playback
through the line out jack on the Porter board. 
The AK4643 ALSA device is available as "hw:1,0". Discussion about the steps involved
in achieving this is beyond the scope of this document. 
