-------------------------------------------------------------------------------------------
Fiberdyne Yocto Layer Setup
-------------------------------------------------------------------------------------------

This tutorial will guide you in setting up the meta-fiberdyne Yocto layer for the Poky 
build environment under Automotive Grade Linux.
For all purposes, the Yocto root directory will be referred to as $WORK.

-------------
Setup
-------------
1. Clone the "agl" branch of the meta-fiberdyne repository into $WORK/meta:

   cd $WORK/meta
   git clone https://github.com/fiberdyne/yocto-meta-fiberdyne.git --branch agl

2. Locate your Yocto bblayers configuration file at $WORK/build/conf/bblayers.conf 
   and add the following lines:

       BBLAYERS_append = " ${METADIR}/../meta-fiberdyne"

   Locate your Yocto local configuration file at $WORK/build/conf/local.conf
   and add the following lines:
    
       IMAGE_INSTALL_append = " fd-dsp"

3. Build your AGL image.

4. Once your image is built, there will be three new commands which can be readily used from the terminal:
      
   fd-dsp      - Run the main DSP background application
   fd-dsp-ui   - Run the DSP GUI application (requires fd-dsp to be running)
   fd-dsp-test - Run an audio test (required fd-dsp to be running)


[NOTE]
  If you are not seeing a UI after running fd-dsp-ui, you may have to switch the desktop shell.
  To do so, edit the following file:

  /etc/xdg/weston/weston.ini

  And ensure that the shell variable is as follows:

  shell=desktop-shell.so

   
-------------------------------------------------------------------------------------------
System Audio Info
-------------------------------------------------------------------------------------------
ALSA has been used to define three audio sinks that supports simultaneous playback 
within multiple processes. 
The underlying ALSA driver supports 48000 KHz sample rate only.

1. sinkStereo 
   Dual channel 32-bit input that emulates any stereo audio (i.e :- music)

2. sinkTel 
   Single channel 32-bit input for telephone audio
  
3. sinkPdc
   Single channel 32-bit input for navigation audio and other mono audio sources

The test application fd-dsp-test uses the standard ALSA tool, aplay, to play stereo
audio using sinkStereo. 
The other sinks can be tested via the same commands used in the test script. 

It must also be noted that, due to the AK4643 codec driver being implemented as a ALSA
device driver, ALSA must be used to initialize the codec for 16-bit audio playback
through the line out jack on the Porter board. 
The AK4643 ALSA device is available as "hw:1,0". Discussion about the steps involved
in achieving this is beyond the scope of this document. 
